<html>
<body>

<h1>Track Your Vaccination</h1>


<script>


var pincode = prompt("ENTER PIN CODE");
var pincodes=["842002"]
pincodes[0]=pincode
var age=prompt("Please enter your age Group(45 or 60)");
var monthNames = [ "01", "02", "03", "04", "05", "06",
    "07", "08", "09", "10", "11", "12" ];
    var today = new Date();
    var dateArr = []
//var dateArr = ["10-05-2021","11-05-2021","12-05-2021","13-05-2021","14-05-2021","15-05-2021"]
var dateArr = [];

for(i=0;i<7;i++){
  dateArr[i]=(today.getDate()+i+"-"+monthNames[today.getMonth()]+"-"+today.getFullYear())
}
var trialCounter = 0;

const sleepNow = (delay) => new Promise((resolve) => setTimeout(resolve, delay))

function httpGet(theUrl,j)
{   document.write("Locating Resources ", " ", pincode," ",dateArr[j],"<br>")

    
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    xmlHttp.send( null );
     
    return xmlHttp.responseText;
}

async function fetchByPincode() {
   
    for(i =0;i<pincodes.length;i++){
    
      for (j=0; j < dateArr.length; j++) {
        url = "https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByPin?pincode="+pincodes[0]+"&date="+dateArr[j];
        
        await sleepNow(1100);
        a = httpGet(url,j);
        try {
          a = JSON.parse(a)
        } catch(e) {
          continue;
        }

        for (c in a.centers) {
        for (s in a.centers[c].sessions) {
            console.log("Looking for Pincode",a.centers[c].pincode,"\n")
            console.clear
              if (a.centers[c].sessions[s].min_age_limit < age && a.centers[c].sessions[s].available_capacity > 0) {
                  document.write("<h1>Available vaccination</h1>")

                document.write("Trying Booking for ", a.centers[c].pincode, a.centers[c].name," Capacity  ", a.centers[c].sessions[s].available_capacity," date: "+dateArr[j]);
                document.write("<br>")
                document.write("<br>")
                var audio = new Audio('https://media.geeksforgeeks.org/wp-content/uploads/20190531135120/beep.mp3');
                audio.play();
              }
          }
          document.write("")
        }
      }
    
    await sleepNow(10000);
    fetchByPincode();
}
}
console.log('Script Initialising');
fetchByPincode();

document.write("My JavaScript");
</script>
<div >

    <script>

        document.write("pincode: ",pincode," date: ",dateArr," Age ",age)
    </script>
</div>
</body>
</html>